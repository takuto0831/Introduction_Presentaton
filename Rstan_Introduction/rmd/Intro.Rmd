---
title: "Rstan Introduction"
date: "`r Sys.Date()`"
author: "Takuto Kotsubo"
output:
  ioslides_presentation:
    widescreen: true
editor_options: 
  chunk_output_type: console
---

```{r set up, message=FALSE,echo=FALSE}
# Global options
library(knitr)
opts_chunk$set(eval = FALSE)
opts_knit$set(width=75)
```

# 第1章: 統計モデリングとStan

## 統計モデリングとは

- 統計モデリングとは確率モデルをデータにあてはめて, 現象の理解と予測を促すことであり, 確率モデルは確率分布とパラメータ(parameter)をつなぐ関係式からできている.

- パラメータとは解析前には値が未知の変数であり, 解析者がどのような値を持つか知りたい対象である.

- **確率モデルの利点は, 確率分布やパラメータをつなぐ関係式に背景知識を様々な形で組み込むことができる点である.**

## 統計モデリングの目的

- 解釈: 現象の理由やしくみを, 納得しやすいモデルを基に解釈することができる

- 予測: 得られたデータから未来のふるまいを予測する. 

## 参考文献

- [1](https://rpubs.com/piroyoung/stan01)
- [2](https://logics-of-blue.com/stanによるベイズ推定の基礎/)

# 第2章: rstanの導入

## install.packages

```{r eval=FALSE}
install.packages("rstan", repos = "https://cloud.r-project.org/", dependencies=TRUE)
```

```{r}
library(rstan)
```

## check install

- インストールできているか, 確認する

```{r}
fx <- inline::cxxfunction( signature(x = "integer", y = "numeric" ) , '
    return ScalarReal( INTEGER(x)[0] * REAL(y)[0] ) ;
' )
fx( 2L, 5 ) 
```

## setting

- 並列処理をするためのコード

```{r}
rstan_options(auto_write = TRUE)
options(mc.cores = parallel::detectCores())
```

## Directory

- ファイル構造について

```
├── Rstan_Introduction.Rproj
├── csv
│   ├── Tokyo_2017_rain.csv
│   ├── Tokyo_2017_sun.csv
│   ├── Tokyo_2017_temp.csv
│   └── Tokyo_2017_wind.csv
├── rmd
│   ├── Intro.Rmd
│   └── Intro.html
└── stan
    ├── simple_model.rds
    └── simple_model.stan
```

# 第3章: rstanの実行例と解釈

## simple model

- verbose: Iterationを表示するか
- iter: サンプリング数
- warmup: サンプリングに使用しない期間(デフォルト: iter/2)
- thin: 間引きする個数(デフォルト: 1)
- chains: マルコフ連鎖の個数

```{r}
# モデルのコンパイル
model1 <- rstan::stan_model('stan/simple_model.stan')
# コンパイルしたモデルを使って, サンプリング
fit1 <- rstan::sampling(object = model1,
                 verbose = TRUE, 
                 iter = 500, 
                 chains = 3)
```

```{r}

```

# 第4章: rstanを活用した応用例

# 第5章: まとめ

## 参考文献

1. 松浦健太郎(2016), 「StanとRでベイズ統計モデリング」共立出版株式会社.
